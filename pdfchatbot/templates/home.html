{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PDF Q&A Chatbot</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>
<body>
    <!-- loading spinning wheel -->
    <div class="loading-overlay" id="loading-spinner">
        <div class="spinner"></div>
    </div>
    <!-- PDF Upload Section -->
    <h3>Upload PDF</h3>
    <form id="pdf_upload_form" action="{% url 'upload' %}" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="file" id="pdf_input" name="pdf_input" accept=".pdf" required>
        <button type="submit" id="upload_pdf_btn">Upload PDF</button>
    </form>

    {% if file_uploaded %}
    <!-- Main Chat Area -->
        <div id="file_name">Uploaded {{ file_name }}</div>
            {% if chat_messages %}
                <div id="chat_messages">
                    {% for message in chat_messages %}
                            <div class="check_message_content">
                                {{ message.content|linebreaks }}
                            </div>
                    {% endfor %}
                </div>
            {% else %}
                <div>
                    <p>Welcome! Ask any question about the uploaded PDF document.</p>
                </div>
            {% endif %}
            <div>
                <form id="chat_form" action="{% url 'chat' %}" method="post">
                    {% csrf_token %}
                    <input type="text" id="chat_input" name="chat_input" placeholder="Ask a question about the document..." required>
                    <button type="submit" id="chat_btn">Send</button>
                </form>
            </div>
    {% else %}
        <div id="file_name">No PDF uploaded yet.</div>
    {% endif %}

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const uploadForm = document.getElementById('pdf_upload_form');
            const chatForm = document.getElementById('chat_form');
            const loadingSpinner = document.getElementById('loading-spinner');

            if (uploadForm) {
                uploadForm.addEventListener('submit', function(event) {
                    loadingSpinner.style.display = 'flex';
                });
            }

            if (chatForm) {
                chatForm.addEventListener('submit', function(event) {
                    loadingSpinner.style.display = 'flex';
                });
            }
        });
    </script>
</body>
</html>